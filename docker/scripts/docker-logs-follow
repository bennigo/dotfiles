#!/usr/bin/env bash
# Follow logs from multiple containers with color coding
# Usage: docker-logs-follow [container1] [container2] ...

set -euo pipefail

if [ $# -eq 0 ]; then
  echo "Usage: docker-logs-follow [container1] [container2] ..."
  echo ""
  echo "Examples:"
  echo "  docker-logs-follow web"
  echo "  docker-logs-follow web db redis"
  echo "  docker-logs-follow \$(docker ps -q)  # all running containers"
  exit 1
fi

# Colors for different containers
COLORS=(
  '\033[0;32m'  # Green
  '\033[0;34m'  # Blue
  '\033[0;35m'  # Magenta
  '\033[0;36m'  # Cyan
  '\033[1;33m'  # Yellow
  '\033[1;31m'  # Red
)
NC='\033[0m'

# Start following logs for each container with color
echo "Following logs for: $@"
echo "Press Ctrl+C to stop"
echo ""

# Build docker compose-style log command
for i in "${!@}"; do
  container="${!i}"
  color_index=$(( (i-1) % ${#COLORS[@]} ))
  color="${COLORS[$color_index]}"

  # Get container name (in case ID was provided)
  name=$(docker inspect --format='{{.Name}}' "$container" 2>/dev/null | sed 's/^\///' || echo "$container")

  docker logs -f --tail=10 "$container" 2>&1 | \
    sed "s/^/$(echo -e "${color}[${name}]${NC}") /" &
done

# Wait for all background processes
wait
